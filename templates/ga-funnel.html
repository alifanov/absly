{% extends 'base.html' %}

{% block content %}
    <div class="container metrics ga-config">
        <h1>Воронка Google Analytics</h1>
        <table class="table">
            <thead>
                <th>Level</th>
                <th>Value</th>
                <th>Funnel</th>
            </thead>
            <tr>
                <td>Acquisition</td>
                <td>{{ ga_users|default:"0" }}</td>
                <td>
                    <div id="ga_acquisition"></div>
                </td>
            </tr>
            <tr>
                <td>Activation</td>
                <td>
                    {% if activation_value %}
                        {{ activation_value|default:"0" }}
                    {% else %}
                        <input name="activation_value" />
                    {% endif %}
                </td>
                <td>
                    <div id="ga_activation"></div>
                </td>
            </tr>
            <tr>
                <td>Retention</td>
                <td>
                    {% if retention_value %}
                        {{ retention_value|default:"0" }}
                    {% else %}
                        <input name="retention_value" />
                    {% endif %}
                </td>
                <td>
                    <div id="ga_retention"></div>
                </td>
            </tr>
            <tr>
                <td>Referral</td>
                <td>
                    {% if referral_value %}
                        {{ referral_value|default:"0" }}
                    {% else %}
                        <input name="referral_value" />
                    {% endif %}
                </td>
                <td>
                    <div id="ga_referral"></div>
                </td>
            </tr>
            <tr>
                <td>Revenue</td>
                <td>
                    {% if revenue_value %}
                        {{ revenue_value|default:"0" }}
                    {% else %}
                        <input name="revenue_value" />
                    {% endif %}
                </td>
                <td>
                    <div id="ga_revenue"></div>
                </td>
            </tr>
        </table>
        <div id="funnel">

        </div>
        {% if ga_users %}
        <script type="text/javascript">
            $(function(){
                var w = $("#ga_acquisition").width();
                var h = $("#ga_acquisition").parent().height();
                var r = Raphael('ga_acquisition', w, h);
                var a1_value = {{ ga_users|default:"0" }};
                var a2_value = {{ activation_value|default:"0" }};
                var w2 = Math.floor(w*a2_value/a1_value);
                var bottom_offset = Math.floor((w - w2)/2);
                console.log(bottom_offset);
                r.path("M0,0L" + w + ",0T" + a2_value - bottom_offset + "," + h + "L" + bottom_offset + "," + h + "T0,0").attr({
                    "fill": "#0aa"
                });
{#                r.hbarchart(0, 0, 600, 600, [#}
{#                    {{ ga_users|default:"0" }},#}
{#                    {{ activation_value|default:"0" }},#}
{#                    {{ retention_value|default:"0" }},#}
{#                    {{ referral_value|default:"0" }},#}
{#                    {{ revenue_value|default:"0" }}#}
{#                ], {});#}
            });
        </script>
    {% endif %}
    </div>
{% endblock %}